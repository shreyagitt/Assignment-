// Generated by CoffeeScript 1.6.2
(function() {
  var explore, removeBackReferences;

  explore = require("./explore");

  module.exports = function(root, options, cb) {
    var current, job, _ref;

    if (typeof options === 'function') {
      _ref = [{}, options], options = _ref[0], cb = _ref[1];
    }
    current = {
      label: root,
      nodes: []
    };
    options.sort = true;
    job = explore(root, options);
    job.on("enter", function(root, name) {
      var child;

      child = {
        parent: current,
        label: name,
        nodes: []
      };
      current.nodes.push(child);
      return current = child;
    });
    job.on("leave", function(root, name) {
      return current = current.parent;
    });
    return job.on("end", function(error) {
      if (error) {
        return cb(error);
      }
      removeBackReferences(current);
      return cb(null, current);
    });
  };

  removeBackReferences = function(dir) {
    var subdir, _i, _len, _ref, _results;

    delete dir.parent;
    _ref = dir.nodes;
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      subdir = _ref[_i];
      _results.push(removeBackReferences(subdir));
    }
    return _results;
  };

}).call(this);

/*
//@ sourceMappingURL=getDirectoryTree.map
*/
